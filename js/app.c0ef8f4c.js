(function(){var e={1040:function(e,t,s){"use strict";var n=s(9242),i=s(3396);const a={class:"container"},r={class:"row top_row"},l={class:"row"};function o(e,t,s,n,o,u){const c=(0,i.up)("LensPlot"),d=(0,i.up)("AnalyzePlot"),h=(0,i.up)("LensSheet"),p=(0,i.up)("FieldSheet");return(0,i.wg)(),(0,i.iD)("div",a,[(0,i._)("div",r,[(0,i.Wm)(c,{system:o.system},null,8,["system"]),(0,i.Wm)(d,{system:o.system},null,8,["system"])]),(0,i._)("div",l,[(0,i.Wm)(h,{system:o.system},null,8,["system"]),(0,i.Wm)(p,{system:o.system},null,8,["system"])])])}const u={class:"ui_sheet ui_block"},c=(0,i._)("div",{class:"ui_block-header"},[(0,i._)("p",null,"Lens Data")],-1),d={class:"ui_block-body"},h=["onMousedown"],p={class:"row"},m={class:"ui_sheet-row-ui"},v=["onClick"],f=["onClick"],w={class:"ui_sheet-row"},y={class:"row"},_={class:"ui_sheet-row-ui"},b=(0,i._)("p",null,"t=thickness, c=curvature (1/R), n=index of refraction",-1);function g(e,t,s,n,a,r){const l=(0,i.up)("OpticSurfaceComponent");return(0,i.wg)(),(0,i.iD)("div",u,[c,(0,i._)("div",d,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.system.surfaces,((e,t)=>((0,i.wg)(),(0,i.iD)("div",{class:"ui_sheet-row",key:t,onMousedown:t=>r.hover(e)},[(0,i._)("div",p,[(0,i._)("div",m,[(0,i._)("button",{onClick:e=>s.system.surfaces.splice(t,1)},"Del",8,v),(0,i._)("button",{onClick:e=>r.addSurface(t)},"Add",8,f)]),(0,i.Wm)(l,{surface:e},null,8,["surface"])])],40,h)))),128)),(0,i._)("div",w,[(0,i._)("div",y,[(0,i._)("div",_,[(0,i._)("button",{onClick:t[0]||(t[0]=e=>r.addSurface(s.system.surfaces.length))},"Add")])])]),b])])}var k=s(7327);class S{constructor(e){(0,k.Z)(this,"index",1.5),this.index=e}}var Z=S;class x{constructor(e){(0,k.Z)(this,"value",0),this.value=e||0}}var C=x,D=s(5789);class E{constructor(e){(0,k.Z)(this,"curvature",new C(0)),this.curvature.value=e}trace(e,t){const s=this.curvature.value;return D.lub((()=>{if(0==s){const s=e.gather(2).div(t.gather(2)).mul(-1);return e.add(t.mul(s))}{const n=t.mul(t).sum(0).mul(s),i=e.mul(t).sum(0).mul(s).sub(t.gather(2)).mul(2),a=e.mul(e).sum(0).mul(s).sub(e.gather(2).mul(2)),r=i.mul(-1).sub(i.mul(i).sub(n.mul(a).mul(4)).sqrt()).div(n).div(2);return n.dispose(),i.dispose(),a.dispose(),e.add(t.mul(r))}}))}normal(e){const t=this.curvature.value;return D.lub((()=>{if(0==t)return e.mul(0).add(D.XeE([[0],[0],[-1]]));{let s=e.sub(D.XeE([[0],[0],[1/t]]));return s.div(s.mul(s).sum(0).sqrt())}}))}surface(e){const t=e**2;return t*this.curvature.value/(1+Math.sqrt(1-t*this.curvature.value**2))}}var O=E;class P{constructor(e,t,s){(0,k.Z)(this,"thickness",new C(0)),(0,k.Z)(this,"shape",new O(0)),(0,k.Z)(this,"material",new Z(1.5)),(0,k.Z)(this,"component","OpticSurfaceComponent"),this.thickness.value=e||this.thickness.value,this.shape.curvature.value=t||this.shape.curvature.value,this.material=s||this.material}}var M=P;class z{constructor(e){(0,k.Z)(this,"angle",new C(0)),this.angle.value=e||this.angle.value}raypos(e,t,s){const n=s.pupilDiameter.value,i=s.principlePlaneZ.value,a=this.angle.value,r=-1,l=e*n,o=t*n+(i-r)*Math.sin(a/180*Math.PI);return[l,o,r]}raydir(e,t){return[0,-Math.sin(this.angle.value/180*Math.PI),Math.cos(this.angle.value/180*Math.PI)]}}var L=z;class N{constructor(){(0,k.Z)(this,"surfaces",[new M(6.1,.04,new Z(1.5108)),new M(2.8,-.01,new Z(1)),new M(1.3,-.01,new Z(1.6042)),new M(5.9,.04,new Z(1)),new M(7.4,.02,new Z(1.5108)),new M(35,-.04,new Z(1)),new M(0,0,new Z(1))]),(0,k.Z)(this,"fields",[new L(0),new L(10),new L(20)]),(0,k.Z)(this,"pupilDiameter",new C(10)),(0,k.Z)(this,"principlePlaneZ",new C(10))}}var T=N,I=s(7139);const W=(0,i._)("label",{for:"thickness"},"t=",-1),V=(0,i._)("span",null,", ",-1),$=(0,i._)("label",{for:"curvature"},"c=",-1),F=(0,i._)("span",null,", ",-1),X=(0,i._)("label",{for:"material"},"n=",-1);function j(e,t,s,a,r,l){const o=(0,i.up)("OpticVarInput");return(0,i.wg)(),(0,i.iD)("div",null,[W,(0,i.Wm)(o,{id:"thickness",step:.01,variable:s.surface.thickness},null,8,["step","variable"]),V,$,(0,i.Wm)(o,{id:"curvature",type:"number",step:1e-4,variable:s.surface.shape.curvature},null,8,["step","variable"]),F,X,(0,i.wy)((0,i._)("input",{id:"material",type:"number",step:"0.01",min:"1",max:"99","onUpdate:modelValue":t[0]||(t[0]=e=>s.surface.material.index=e)},null,512),[[n.nr,s.surface.material.index,void 0,{number:!0}]]),(0,i._)("span",null," (R="+(0,I.zw)((1/s.surface.shape.curvature.value).toFixed(2))+") ",1)])}const R=["step"];function A(e,t,s,a,r,l){return(0,i.wg)(),(0,i.iD)("div",{class:(0,I.C_)(["optic_var_input",{"optic_var_input-editmode":r.editmode}])},[(0,i.wy)((0,i._)("input",{ref:"input",type:"number","onUpdate:modelValue":t[0]||(t[0]=e=>s.variable.value=e),step:s.step},null,8,R),[[n.nr,s.variable.value]])],2)}function q(e,t){let s=null,n=!1,i=null,a=[];async function r(){n=!0,i=this,a=arguments,null==s&&(s=0,await t.apply(i,a),n=!1,s=setTimeout((function(){s=null,n&&r.apply(i,a)}),e))}return r}function U(e,t){let s=null,n=!1,i=null,a=[];function r(){n=!0,i=this,a=arguments,null==s&&(t.apply(i,a),n=!1,s=setTimeout((function(){s=null,n&&r.apply(i,a)}),e))}return r}var H={props:{variable:C,step:Number},data(){return{editmode:!1,tweakmode:!1,tweaked:!1,tempValue:this.variable.value}},methods:{mousedown(e){this.editmode||(e.preventDefault(),this.tweakmode=!0,this.tweaked=!1)},mouseup(e){this.tweakmode&&!this.tweaked&&(this.editmode=!0,this.tweakmode=!1,this.$refs.input.focus()),this.tweakmode=!1},mousemove(e){this.tweakmode&&(this.tweaked=!0,this.tempValue+=e.movementX*this.step,this.updatevalue())},reset(){this.editmode=!1,this.tweakmode=!1},updatevalue:U(10,(function(){this.variable.value=this.tempValue}))},mounted(){this.$refs.input.addEventListener("mousedown",this.mousedown),addEventListener("mouseup",this.mouseup),addEventListener("mousemove",this.mousemove),this.$refs.input.addEventListener("blur",this.reset)},beforeUnmount(){this.$refs.input.removeEventListener("mousedown",this.mousedown),removeEventListener("mouseup",this.mouseup),removeEventListener("mousemove",this.mousemove),this.$refs.input.removeEventListener("blur",this.reset)}},B=s(89);const K=(0,B.Z)(H,[["render",A],["__scopeId","data-v-5df87b0e"]]);var Y=K,Q={props:{surface:M},components:{OpticVarInput:Y},data(){return{}}};const G=(0,B.Z)(Q,[["render",j]]);var J=G;const ee={focusedSurface:null,colorlist:["red","green","blue","yellow","cyan","magenta"]};var te=ee,se={props:{system:T},components:{OpticSurfaceComponent:J},methods:{addSurface(e){this.system.surfaces.splice(e,0,new M)},hover(e){te.focusedSurface=e}}};const ne=(0,B.Z)(se,[["render",g]]);var ie=ne;const ae=e=>((0,i.dD)("data-v-75c12019"),e=e(),(0,i.Cn)(),e),re={class:"lens_plot ui_block"},le=ae((()=>(0,i._)("div",{class:"ui_block-header"},[(0,i._)("p",null,"Plot")],-1))),oe={class:"ui_block-body"},ue={ref:"container",class:"lens_plot-container"},ce={ref:"canvas"};function de(e,t,s,n,a,r){return(0,i.wg)(),(0,i.iD)("div",re,[le,(0,i._)("div",oe,[(0,i._)("div",ue,[(0,i._)("canvas",ce,null,512)],512)])])}s(7658);function he(e,t,s){D.SRH().startScope();let n=[];n.push(t.array());let i=1,a=0;for(let r of e.surfaces){let e=r.material.index;t=r.shape.trace(t.sub(D.XeE([[0],[0],[a]])),s);let l=r.shape.normal(t);s=s.div(s.mul(s).sum(0).sqrt()).mul(i),l=l.mul(s.mul(l).sum(0).sign());let o=D.luU(1,s.mul(l).sum(0)),u=D.luU(e**2,o).sqrt().sub(D.luU(i**2,o).sqrt());s=s.add(l.mul(u)),t=t.add(D.XeE([[0],[0],[a]])),n.push(t.array()),i=e,a+=r.thickness.value}return D.SRH().endScope(),n}var pe=he;async function me(e){let t=[],s=[],n=7;for(let i=0;i<=n;i++)for(let a of e.fields){let r=i/n-.5;t.push(a.raypos(0,r,e)),s.push(a.raydir(0,r,e))}return t=D.XeE(t).transpose(),s=D.XeE(s).transpose(),Promise.all(pe(e,t,s))}var ve=me,fe={props:{system:T},data(){return{canvas:null,ctx:null,ViewState:te}},methods:{resize(){const e=this.$refs.container.getBoundingClientRect();this.$refs.canvas.width=e.width,this.$refs.canvas.height=e.height,this.update()},update:q(10,(async function(){const e=this.canvas,t=this.ctx,s=await ve(this.system);t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.translate(e.width/2,e.height/2);let n=0;for(let u of this.system.surfaces)n+=u.thickness.value;let i=[],a=0;for(let u=1;u<s.length;u++){let e=0;for(let t=0;t<s[0][0].length;t++){let n=s[u][1][t];isNaN(n)||(e=Math.max(e,Math.abs(n)))}i.push(e),a=Math.max(e,a)}let r=e.width/n*.9;r=Math.min(r,e.height/a/2*.9),t.scale(r,r),t.translate(-n/2,0),t.lineWidth=2/r,t.strokeStyle="#333",t.beginPath(),t.moveTo(0,0),t.lineTo(n,0),t.stroke(),t.strokeStyle="#EEE";const l=50;let o=0;t.fillStyle="#111";for(let u=0;u<this.system.surfaces.length;u++){let e=this.system.surfaces[u],s=i[u],n=u<this.system.surfaces.length-1&&e.material.index>1;n&&(s=Math.max(s,i[u+1])),t.beginPath();for(let i=0;i<=l;i++){let n=2*(i/l-.5)*s,a=e.shape.surface(n);isNaN(n)||isNaN(a)||(0==i?t.moveTo(o+a,n):t.lineTo(o+a,n))}if(n){let n=this.system.surfaces[u+1];for(let i=0;i<=l;i++){let a=2*-(i/l-.5)*s,r=n.shape.surface(a);isNaN(a)||isNaN(r)||t.lineTo(o+r+e.thickness.value,a)}t.closePath(),t.fill()}if(t.stroke(),e==te.focusedSurface){t.save(),t.strokeStyle="orange",t.lineWidth=3/r,t.beginPath();for(let n=0;n<=l;n++){let i=2*(n/l-.5)*s,a=e.shape.surface(i);isNaN(i)||isNaN(a)||(0==n?t.moveTo(o+a,i):t.lineTo(o+a,i))}t.stroke(),t.restore()}o+=e.thickness.value}t.lineWidth=1.5/r;for(let u=0;u<s[0][0].length;u++){t.strokeStyle=te.colorlist[u%this.system.fields.length%te.colorlist.length],t.beginPath();for(let e=0;e<s.length;e++){let n=s[e][1][u],i=s[e][2][u];0==e?t.moveTo(i,n):t.lineTo(i,n)}t.stroke()}}),50)},watch:{system:{handler(){this.update()},deep:!0},ViewState:{handler(){this.update()},deep:!0}},mounted(){this.canvas=this.$refs.canvas,this.ctx=this.canvas.getContext("2d"),addEventListener("resize",this.resize),this.resize()},unmounted(){removeEventListener("resize",this.resize)}};const we=(0,B.Z)(fe,[["render",de],["__scopeId","data-v-75c12019"]]);var ye=we;D.CQI("cpu");const _e=new T;var be={system:_e};class ge{constructor(e){(0,k.Z)(this,"classes",{});for(let t of e)this.classes[t.name]=t}serialize(e){this._serialize(e);for(let t in e)console.log(t)}_serialize(e){console.log("type:",typeof e),console.log("class:",e.constructor.name)}}const ke=new ge([T]);var Se=ke;const Ze={class:"ui_sheet ui_block"},xe=(0,i._)("div",{class:"ui_block-header"},[(0,i._)("p",null,"Field Data")],-1),Ce={class:"ui_block-body"},De=(0,i._)("label",{for:"diameter"},"D=",-1),Ee=(0,i._)("label",{for:"Z"},"Z=",-1),Oe={class:"row"},Pe={class:"ui_sheet-row-ui"},Me=["onClick"],ze=["onClick"],Le={class:"ui_sheet-row"},Ne={class:"row"},Te={class:"ui_sheet-row-ui"};function Ie(e,t,s,n,a,r){const l=(0,i.up)("OpticVarInput"),o=(0,i.up)("OpticFieldComponent");return(0,i.wg)(),(0,i.iD)("div",Ze,[xe,(0,i._)("div",Ce,[(0,i._)("div",null,[De,(0,i.Wm)(l,{id:"diameter",step:.01,variable:s.system.pupilDiameter},null,8,["step","variable"]),Ee,(0,i.Wm)(l,{id:"Z",step:.01,variable:s.system.principlePlaneZ},null,8,["step","variable"])]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.system.fields,((e,t)=>((0,i.wg)(),(0,i.iD)("div",{class:"ui_sheet-row",key:t},[(0,i._)("div",Oe,[(0,i._)("div",Pe,[(0,i._)("button",{onClick:e=>s.system.fields.splice(t,1)},"Del",8,Me),(0,i._)("button",{onClick:e=>r.addField(t)},"Add",8,ze)]),(0,i.Wm)(o,{field:e},null,8,["field"])])])))),128)),(0,i._)("div",Le,[(0,i._)("div",Ne,[(0,i._)("div",Te,[(0,i._)("button",{onClick:t[0]||(t[0]=e=>r.addField(s.system.fields.length))},"Add")])])])])])}const We=(0,i._)("label",{for:"angle"},"angle=",-1);function Ve(e,t,s,n,a,r){const l=(0,i.up)("OpticVarInput");return(0,i.wg)(),(0,i.iD)("div",null,[We,(0,i.Wm)(l,{id:"angle",step:.02,variable:s.field.angle},null,8,["step","variable"])])}var $e={props:{field:L},components:{OpticVarInput:Y},data(){return{}}};const Fe=(0,B.Z)($e,[["render",Ve]]);var Xe=Fe,je={props:{system:T},components:{OpticFieldComponent:Xe,OpticVarInput:Y},methods:{addField(e){this.system.fields.splice(e,0,new L)}}};const Re=(0,B.Z)(je,[["render",Ie]]);var Ae=Re;const qe=e=>((0,i.dD)("data-v-2da45757"),e=e(),(0,i.Cn)(),e),Ue={class:"analyze_plot ui_block"},He=qe((()=>(0,i._)("div",{class:"ui_block-header"},[(0,i._)("p",null,"Spot Diagram")],-1))),Be={class:"ui_block-body"},Ke={ref:"container",class:"analyze_plot-container"},Ye={ref:"canvas"};function Qe(e,t,s,n,a,r){return(0,i.wg)(),(0,i.iD)("div",Ue,[He,(0,i._)("div",Be,[(0,i._)("div",Ke,[(0,i._)("canvas",Ye,null,512)],512)])])}async function Ge(e){let t=[],s=[],n=5;for(let r=0;r<=n;r++){let i=r/n,a=16*i+1;for(let n=0;n<a;n++){let r=n/a,l=i*Math.cos(r*Math.PI*2),o=i*Math.sin(r*Math.PI*2);for(let n of e.fields)t.push(n.raypos(l,o,e)),s.push(n.raydir(l,o,e))}}t=D.XeE(t).transpose(),s=D.XeE(s).transpose();let i=pe(e,t,s),a=await i[i.length-1];return a}var Je=Ge,et={props:{system:T},data(){return{canvas:null,ctx:null}},methods:{resize(){const e=this.$refs.container.getBoundingClientRect();this.$refs.canvas.width=e.width,this.$refs.canvas.height=e.height,this.update()},update:q(10,(async function(){const e=this.canvas,t=this.ctx,s=await Je(this.system);t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.translate(e.width/2,e.height/2),t.beginPath();let n=s[1][0],i=s[1][0];for(let r=0;r<s[0].length;r++){let e=s[1][r];isNaN(e)||(n=Math.max(e,n),i=Math.min(e,i))}let a=e.height/(n-i+2)*.8;t.scale(a,a),t.translate(0,-(n+i)/2),t.lineWidth=1/a;for(let r=0;r<s[0].length;r++){t.beginPath(),t.strokeStyle=te.colorlist[r%this.system.fields.length%te.colorlist.length];let e=s[0][r],n=s[1][r];t.rect(e,n,5/a,5/a),t.stroke()}}))},watch:{system:{handler(){this.update()},deep:!0}},mounted(){this.canvas=this.$refs.canvas,this.ctx=this.canvas.getContext("2d"),addEventListener("resize",this.resize),this.resize()},unmounted(){removeEventListener("resize",this.resize)}};const tt=(0,B.Z)(et,[["render",Qe],["__scopeId","data-v-2da45757"]]);var st=tt,nt={name:"App",data(){return{system:be.system}},components:{LensSheet:ie,LensPlot:ye,FieldSheet:Ae,AnalyzePlot:st},mounted(){Se.serialize(this.system)},watch:{system:{handler(){},deep:!0}}};const it=(0,B.Z)(nt,[["render",o],["__scopeId","data-v-f8143864"]]);var at=it;(0,n.ri)(at).mount("#app")},5410:function(){},8628:function(){},1601:function(){},7792:function(){},4977:function(){},5042:function(){}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(a.exports,a,a.exports,s),a.loaded=!0,a.exports}s.m=e,function(){s.amdD=function(){throw new Error("define cannot be used indirect")}}(),function(){s.amdO={}}(),function(){var e=[];s.O=function(t,n,i,a){if(!n){var r=1/0;for(c=0;c<e.length;c++){n=e[c][0],i=e[c][1],a=e[c][2];for(var l=!0,o=0;o<n.length;o++)(!1&a||r>=a)&&Object.keys(s.O).every((function(e){return s.O[e](n[o])}))?n.splice(o--,1):(l=!1,a<r&&(r=a));if(l){e.splice(c--,1);var u=i();void 0!==u&&(t=u)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[n,i,a]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,n){var i,a,r=n[0],l=n[1],o=n[2],u=0;if(r.some((function(t){return 0!==e[t]}))){for(i in l)s.o(l,i)&&(s.m[i]=l[i]);if(o)var c=o(s)}for(t&&t(n);u<r.length;u++)a=r[u],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(c)},n=self["webpackChunkoptictool"]=self["webpackChunkoptictool"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=s.O(void 0,[998],(function(){return s(1040)}));n=s.O(n)})();
//# sourceMappingURL=app.c0ef8f4c.js.map