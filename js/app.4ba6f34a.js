(function(){var e={1296:function(e,t,s){"use strict";var n=s(9242),i=s(3396);const r={class:"container"},a={class:"row"};function u(e,t,s,n,u,o){const l=(0,i.up)("LensPlot"),c=(0,i.up)("LensSheet"),d=(0,i.up)("FieldSheet");return(0,i.wg)(),(0,i.iD)("div",r,[(0,i._)("div",null,[(0,i.Wm)(l,{system:u.system},null,8,["system"])]),(0,i._)("div",a,[(0,i.Wm)(c,{system:u.system},null,8,["system"]),(0,i.Wm)(d,{system:u.system},null,8,["system"])])])}const o={class:"ui_sheet ui_block"},l=(0,i._)("p",null,"Lens Data",-1),c={class:"row"},d={class:"ui_sheet-row-ui"},h=["onClick"],m=["onClick"],p={class:"ui_sheet-row"},v={class:"row"},f={class:"ui_sheet-row-ui"},w=(0,i._)("p",null,"t=thickness, c=curvature (1/R), n=index of refraction",-1);function b(e,t,s,n,r,a){const u=(0,i.up)("OpticSurfaceComponent");return(0,i.wg)(),(0,i.iD)("div",o,[l,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.system.surfaces,((e,t)=>((0,i.wg)(),(0,i.iD)("div",{class:"ui_sheet-row",key:t},[(0,i._)("div",c,[(0,i._)("div",d,[(0,i._)("button",{onClick:e=>s.system.surfaces.splice(t,1)},"-",8,h),(0,i._)("button",{onClick:e=>a.addSurface(t)},"+",8,m)]),(0,i.Wm)(u,{surface:e},null,8,["surface"])])])))),128)),(0,i._)("div",p,[(0,i._)("div",v,[(0,i._)("div",f,[(0,i._)("button",{onClick:t[0]||(t[0]=e=>a.addSurface(s.system.surfaces.length))},"+")])])]),w])}var _=s(7327);class y{constructor(e){(0,_.Z)(this,"index",1.5),this.index=e}}var g=y;class k{constructor(e){(0,_.Z)(this,"value",0),this.value=e||0}}var Z=k,O=s(5789);class S{constructor(e){(0,_.Z)(this,"curvature",new Z(0)),this.curvature.value=e}trace(e,t){const s=this.curvature.value;if(0==s){const s=e.gather(2).div(t.gather(2)).mul(-1);return e.add(t.mul(s))}{const n=t.mul(t).sum(0).mul(s),i=e.mul(t).sum(0).mul(s).sub(t.gather(2)).mul(2),r=e.mul(e).sum(0).mul(s).sub(e.gather(2).mul(2)),a=i.mul(-1).sub(i.mul(i).sub(n.mul(r).mul(4)).sqrt()).div(n).div(2);return e.add(t.mul(a))}}normal(e){const t=this.curvature.value;if(0==t)return e.mul(0).add(O.XeE([[0],[0],[-1]]));{let s=e.sub(O.XeE([[0],[0],[1/t]]));return s.div(s.mul(s).sum(0).sqrt())}}surface(e){const t=e**2;return t*this.curvature.value/(1+Math.sqrt(1-t*this.curvature.value**2))}}var C=S;class D{constructor(e,t,s){(0,_.Z)(this,"thickness",new Z(0)),(0,_.Z)(this,"shape",new C(0)),(0,_.Z)(this,"material",new g(1.5)),(0,_.Z)(this,"component","OpticSurfaceComponent"),this.thickness.value=e||this.thickness.value,this.shape.curvature.value=t||this.shape.curvature.value,this.material=s||this.material}}var E=D;class x{constructor(e){(0,_.Z)(this,"angle",new Z(0)),this.angle.value=e||this.angle.value}raypos(e,t){const s=-1,n=e*t.pupilDiameter.value+(t.principlePlaneZ.value-s)*Math.sin(this.angle.value/180*Math.PI);return[0,n,s]}raydir(e){return[0,-Math.sin(this.angle.value/180*Math.PI),Math.cos(this.angle.value/180*Math.PI)]}}var L=x;class P{constructor(){(0,_.Z)(this,"surfaces",[new E(6.1,.04,new g(1.5108)),new E(2.8,-.01,new g(1)),new E(1.3,-.01,new g(1.6042)),new E(5.9,.04,new g(1)),new E(7.4,.02,new g(1.5108)),new E(35,-.04,new g(1)),new E(0,0,new g(1))]),(0,_.Z)(this,"fields",[new L(0),new L(10),new L(20)]),(0,_.Z)(this,"pupilDiameter",new Z(20)),(0,_.Z)(this,"principlePlaneZ",new Z(10))}}var W=P,z=s(7139);const I=(0,i._)("label",{for:"thickness"},"t=",-1),F=(0,i._)("span",null,", ",-1),M=(0,i._)("label",{for:"curvature"},"c=",-1),T=(0,i._)("span",null,", ",-1),$=(0,i._)("label",{for:"material"},"n=",-1);function j(e,t,s,r,a,u){const o=(0,i.up)("OpticVarInput");return(0,i.wg)(),(0,i.iD)("div",null,[I,(0,i.Wm)(o,{id:"thickness",step:.01,variable:s.surface.thickness},null,8,["step","variable"]),F,M,(0,i.Wm)(o,{id:"curvature",type:"number",step:1e-4,variable:s.surface.shape.curvature},null,8,["step","variable"]),T,$,(0,i.wy)((0,i._)("input",{id:"material",type:"number",step:"0.01",min:"1",max:"99","onUpdate:modelValue":t[0]||(t[0]=e=>s.surface.material.index=e)},null,512),[[n.nr,s.surface.material.index,void 0,{number:!0}]]),(0,i._)("span",null,"R="+(0,z.zw)((1/s.surface.shape.curvature.value).toFixed(2))+", ",1)])}const V=["step"];function X(e,t,s,r,a,u){return(0,i.wg)(),(0,i.iD)("div",{class:(0,z.C_)(["optic_var_input",{"optic_var_input-editmode":a.editmode}])},[(0,i.wy)((0,i._)("input",{ref:"input",type:"number","onUpdate:modelValue":t[0]||(t[0]=e=>s.variable.value=e),step:s.step},null,8,V),[[n.nr,s.variable.value]])],2)}var q={props:{variable:Z,step:Number},data(){return{editmode:!1,tweakmode:!1,tweaked:!1}},methods:{mousedown(e){this.editmode||(e.preventDefault(),this.tweakmode=!0,this.tweaked=!1)},mouseup(e){this.tweakmode&&!this.tweaked&&(this.editmode=!0,this.tweakmode=!1,this.$refs.input.focus()),this.tweakmode=!1},mousemove(e){this.tweakmode&&(this.tweaked=!0,this.variable.value+=e.movementX*this.step)},reset(){this.editmode=!1,this.tweakmode=!1}},mounted(){this.$refs.input.addEventListener("mousedown",this.mousedown),addEventListener("mouseup",this.mouseup),addEventListener("mousemove",this.mousemove),this.$refs.input.addEventListener("blur",this.reset)},beforeUnmount(){this.$refs.input.removeEventListener("mousedown",this.mousedown),removeEventListener("mouseup",this.mouseup),removeEventListener("mousemove",this.mousemove),this.$refs.input.removeEventListener("blur",this.reset)}},R=s(89);const U=(0,R.Z)(q,[["render",X],["__scopeId","data-v-23a5c630"]]);var H=U,K={props:{surface:E},components:{OpticVarInput:H},data(){return{}}};const Y=(0,R.Z)(K,[["render",j]]);var A=Y,B={props:{system:W},components:{OpticSurfaceComponent:A},methods:{addSurface(e){this.system.surfaces.splice(e,0,new E)}}};const N=(0,R.Z)(B,[["render",b]]);var G=N;const J={class:"lens_plot ui_block"},Q={ref:"container",class:"lens_plot-container"},ee={ref:"canvas"};function te(e,t,s,n,r,a){return(0,i.wg)(),(0,i.iD)("div",J,[(0,i._)("div",Q,[(0,i._)("canvas",ee,null,512)],512)])}s(7658);function se(e){O.SRH().startScope();let t=[],s=[],n=7;e.pupilDiameter.value;for(let u of e.fields)for(let i=0;i<n;i++){let r=i/n-.5;t.push(u.raypos(r,e)),s.push(u.raydir(r,e))}t=O.XeE(t).transpose(),s=O.XeE(s).transpose();let i=[];i.push(t.arraySync());e.surfaces[0];let r=1,a=0;for(let u of e.surfaces){let e=u.material.index;t=u.shape.trace(t.sub(O.XeE([[0],[0],[a]])),s);let n=u.shape.normal(t);s=s.div(s.mul(s).sum(0).sqrt()).mul(r),n=n.mul(s.mul(n).sum(0).sign());let o=O.luU(1,s.mul(n).sum(0)),l=O.luU(e**2,o).sqrt().sub(O.luU(r**2,o).sqrt());s=s.add(n.mul(l)),t=t.add(O.XeE([[0],[0],[a]])),i.push(t.arraySync()),r=e,a+=u.thickness.value}return O.SRH().endScope(),i}var ne=se,ie=s(4806),re=s.n(ie),ae={props:{system:W},data(){return{canvas:null,ctx:null}},methods:{resize(){const e=this.$refs.container.getBoundingClientRect();this.$refs.canvas.width=e.width,this.$refs.canvas.height=e.height,this.update()},update:re().throttle((function(){console.log("update");const e=this.canvas,t=this.ctx;t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.translate(e.width/2,e.height/2);let s=0;for(let u of this.system.surfaces)s+=u.thickness.value;let n=e.width/s*.8;t.scale(n,n),t.lineWidth=1/n,t.translate(-s/2,0);const i=ne(this.system);t.strokeStyle="blue";for(let u=0;u<i[0][0].length;u++){t.beginPath();for(let e=0;e<i.length;e++){let s=i[e][1][u],n=i[e][2][u];0==e?t.moveTo(n,s):t.lineTo(n,s)}t.stroke()}t.lineWidth=2/n,t.strokeStyle="black";const r=30;let a=0;for(let u of this.system.surfaces){let e=15;t.beginPath();for(let s=0;s<=r;s++){let n=2*(s/r-.5)*e,i=u.shape.surface(n);0==s?t.moveTo(a+i,n):t.lineTo(a+i,n)}t.stroke(),a+=u.thickness.value}}),50)},watch:{system:{handler(){this.update()},deep:!0}},mounted(){this.canvas=this.$refs.canvas,this.ctx=this.canvas.getContext("2d"),addEventListener("resize",this.resize),this.resize()},unmounted(){removeEventListener("resize",this.resize)}};const ue=(0,R.Z)(ae,[["render",te],["__scopeId","data-v-4a5002f1"]]);var oe=ue;const le=new W;var ce={system:le};class de{constructor(e){(0,_.Z)(this,"classes",{});for(let t of e)this.classes[t.name]=t}serialize(e){this._serialize(e);for(let t in e)console.log(t)}_serialize(e){console.log("type:",typeof e),console.log("class:",e.constructor.name)}}const he=new de([W]);var me=he;const pe={class:"ui_sheet ui_block"},ve=(0,i._)("p",null,"Field Data",-1),fe=(0,i._)("label",{for:"diameter"},"D=",-1),we=(0,i._)("label",{for:"Z"},"Z=",-1),be={class:"row"},_e={class:"ui_sheet-row-ui"},ye=["onClick"],ge=["onClick"],ke={class:"ui_sheet-row"},Ze={class:"row"},Oe={class:"ui_sheet-row-ui"};function Se(e,t,s,n,r,a){const u=(0,i.up)("OpticVarInput"),o=(0,i.up)("OpticFieldComponent");return(0,i.wg)(),(0,i.iD)("div",pe,[ve,(0,i._)("div",null,[fe,(0,i.Wm)(u,{id:"diameter",step:.01,variable:s.system.pupilDiameter},null,8,["step","variable"]),we,(0,i.Wm)(u,{id:"Z",step:.01,variable:s.system.principlePlaneZ},null,8,["step","variable"])]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.system.fields,((e,t)=>((0,i.wg)(),(0,i.iD)("div",{class:"ui_sheet-row",key:t},[(0,i._)("div",be,[(0,i._)("div",_e,[(0,i._)("button",{onClick:e=>s.system.fields.splice(t,1)},"-",8,ye),(0,i._)("button",{onClick:e=>a.addField(t)},"+",8,ge)]),(0,i.Wm)(o,{field:e},null,8,["field"])])])))),128)),(0,i._)("div",ke,[(0,i._)("div",Ze,[(0,i._)("div",Oe,[(0,i._)("button",{onClick:t[0]||(t[0]=e=>a.addField(s.system.fields.length))},"+")])])])])}const Ce=(0,i._)("label",{for:"angle"},"angle=",-1);function De(e,t,s,n,r,a){const u=(0,i.up)("OpticVarInput");return(0,i.wg)(),(0,i.iD)("div",null,[Ce,(0,i.Wm)(u,{id:"angle",step:.02,variable:s.field.angle},null,8,["step","variable"])])}var Ee={props:{field:L},components:{OpticVarInput:H},data(){return{}}};const xe=(0,R.Z)(Ee,[["render",De]]);var Le=xe,Pe={props:{system:W},components:{OpticFieldComponent:Le,OpticVarInput:H},methods:{addField(e){this.system.fields.splice(e,0,new L)}}};const We=(0,R.Z)(Pe,[["render",Se]]);var ze=We,Ie={name:"App",data(){return{system:ce.system}},components:{LensSheet:G,LensPlot:oe,FieldSheet:ze},mounted(){me.serialize(this.system)},watch:{system:{handler(){},deep:!0}}};const Fe=(0,R.Z)(Ie,[["render",u]]);var Me=Fe;(0,n.ri)(Me).mount("#app")},5410:function(){},8628:function(){},1601:function(){},7792:function(){},4977:function(){},5042:function(){}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.loaded=!0,r.exports}s.m=e,function(){s.amdD=function(){throw new Error("define cannot be used indirect")}}(),function(){s.amdO={}}(),function(){var e=[];s.O=function(t,n,i,r){if(!n){var a=1/0;for(c=0;c<e.length;c++){n=e[c][0],i=e[c][1],r=e[c][2];for(var u=!0,o=0;o<n.length;o++)(!1&r||a>=r)&&Object.keys(s.O).every((function(e){return s.O[e](n[o])}))?n.splice(o--,1):(u=!1,r<a&&(a=r));if(u){e.splice(c--,1);var l=i();void 0!==l&&(t=l)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[n,i,r]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,n){var i,r,a=n[0],u=n[1],o=n[2],l=0;if(a.some((function(t){return 0!==e[t]}))){for(i in u)s.o(u,i)&&(s.m[i]=u[i]);if(o)var c=o(s)}for(t&&t(n);l<a.length;l++)r=a[l],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(c)},n=self["webpackChunkoptictool"]=self["webpackChunkoptictool"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=s.O(void 0,[998],(function(){return s(1296)}));n=s.O(n)})();
//# sourceMappingURL=app.4ba6f34a.js.map